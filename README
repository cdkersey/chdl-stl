CHDL Standard Template Library
==============================

The CHDL STL is an auxilliary library of useful components that are considered
secondary to the CHDL core. These may be distributed alongside CHDL but retain
an identity as a separately-maintained, separately-tested entity, depending on
the core features provided by CHDL.

Contents
--------

  1 API Documentation
    1.1 Aggregate Types
      1.1.1 strtype
      1.1.2 ag
    1.2 Queue
    1.3 Stack
    1.4 Map
    1.5 Network
     1.5.1 flit
     1.5.2 Buffer
     1.5.3 Arbiter
     1.5.4 Router
  2 Examples

1 API Documentation
-------------------

1.1 Aggregate Types
-------------------

It is convenient when using CHDL to bundle together CHDL types into C++ structs
and classes, so that collections of signals and functions operating on them may
be passed all of these sinals as a bundle. The downside is that this collection
of signals cannot then be easily, collectively tapped or operated on by CHDL
standard library functions without this functionality being added manually for
each such struct.

C++ does not really provide the level of reflection needed to allow the
creation of such utility functions as conversions to bvec at compile time for
arbitrary structs, or if it does the author is not aware of it. Enter chdl::ag
and the surrounding ecosystem of types, a way to get around this problem by
replacing C++ structs with an equivalent template type.

For example, say you had a library that used sign-exponent-mantissa floating
point numbers. It may really be more appropriate to build these as a C++ class
templates, but for the purposes of our example you could implement it using a
CHDL aggregate (using C++11 alias templates) as:

  template <unsigned E, unsigned M> using Float =
    ag<STRTYPE("sign"),     node,
    ag<STRTYPE("exponent"), bvec<E>,
    ag<STRTYPE("mantissa"), bvec<M> > > >;

The STRTYPE() macro converts an input string to a type, so that it may be
evaluated and compared at compile time. Members of Float can be extracted using
the Lookup<> function:

  template <unsigned E, unsigned M> Float<E, M> Neg(Float<E, M> &in) {
    Float<E, M> out;
    Lookup<STRTYPE("sign")>(out) = !Lookup<STRTYPE("sign")>(in);
    Lookup<STRTYPE("exponent")>(out) = Lookup<STRTYPE("exponent")>(in);
    Lookup<STRTYPE("mantissa")>(out) = Lookup<STRTYPE("mantissa")>(in);

    return out;
  }

This is rather verbose, but is made somewhat better by using the "_" macro:

  template <unsigned E, unsigned M> Float<E, M> Neg(Float<E, M> &in) {
    Float<E, M> out;
    _(out, "sign") = !_(in, "sign");
    _(out, "exponent") = _(in, "exponent");
    _(out, "mantissa") = _(in, "mantissa");
    
    return out;
  }

Of course, this is a potentially contentuous macro name, and in the event of a
conflict, it can be disabled by defining CHDL_AG_DISABLE_UNDERSCORE before
including ag.h.

1.1.1 strtype<C, NEXT>
----------------------

Description:

  A template that encodes a string as a linked list of types.

1.1.2 ag<NAME, T, NEXT>
-----------------------

Description:

  A template that encodes a structured data type as a linked list of types.

1.2 Queue
---------

Description:

  A 2^SZ-entry queue

  template <typename T, unsigned SZ>
    T Queue(T input, node push, node pop, bvec<SZ + 1> &sz);

  Template parameters:
    T  - The type of objects in the queue.
    SZ - LOG2 of the number of entries in the queue.

  Inputs:
    input - The item to be enqueued during any cycle in which push is high.
    push  - The "push" command.
    pop   - The "pop" command.

  Outputs:
    sz      - Current number of items in the queue.
    returns - The head of the queue.

1.3 Stack
---------

Description:

  A 2^SZ-entry stack

  template <typename T, unsigned SZ>
    T Stack(T input, node push, node pop, bvec<SZ + 1> &sz);

  Template parameters:
    T  - The type of objects in the stack.
    SZ - LOG2 of the number of entries in the stack.

  Inputs:
    input - The item to be pushed during any cycle in which push is high.
    push  - The "push" command.
    pop   - The "pop" command.

  Outputs:
    sz      - Current number of items in the stack.
    returns - The contents of the top of the stack.

1.4 Map
-------

Description:

  A SZ-entry fully-associative memory holding key/value pairs

  Template parameters:
    K  - Number of bits in key.
    V  - Number of bits in value.
    SZ - Number of entries.

  Inputs:
    qkey  - The key for the primary output.
    dkey  - The key to write or erase.
    d     - The value to be written.
    write - Perform write.
    erase - Remove entry with key "dkey" from map.

  Outputs:
    full    - There are no entries remaining.
    inmap   - There is an entry with key "qkey".
    returns - The value stored at key "qkey".

1.5 Network
-----------

1.5.1 flit
----------

1.5.2 Buffer
------------

1.5.3 Arbiter
-------------

1.5.4 Router
------------

2 Examples
----------
